<html>
<head>
    <title>RPG</title>
    <script src = https://code.jquery.com/jquery-3.6.0.min.js></script>
    <link href="/css/my.css" rel="stylesheet">
<<<<<<< HEAD
</head>
<body>
<h1>RPG admin panel</h1>
=======
    <style>
        /* Стили для таблицы */
        #myTable {
            border-collapse: collapse; /* Объединение границ ячеек */
        }

        #myTable th, #myTable td {
            border: 1px solid black; /* Границы ячеек */
            padding: 8px; /* Отступ внутри ячеек */
        }


    </style>
</head>
<body>
<h1>RPG admin panel</h1>
<h2>Accounts list:</h2>

<div id="paging">
    Count per page:
    <select id="pageSize">
        <option value="3" selected="selected">3</option>
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>

    </select>

</div><br>

<table id="myTable">
    <thead>
    <tr>
        <th>#</th>
        <th>Name</th>
        <th>Title</th>
        <th>Race</th>
        <th>Profession</th>
        <th>Level</th>
        <th>Birthday</th>
        <th>Banned</th>
        <th>Edit</th>
        <th>Delete</th>
    </tr>
    </thead>
    <tbody>    </tbody>
</table>

</br>

<div id="pagination-section">Pages: </div>

<script>
    // -- Блок переменных --
    let selectElement = document.getElementById('pageSize'); // -- получение элементов выбора --
    let table = document.getElementById("myTable"); // -- получение таблицы --
    let tbody = table.querySelector("tbody");       // -- получение блока tbody таблицы --
    // -- получение секции кнопок с нумерациями страниц --
    let paginationSection = document.getElementById('pagination-section');
    let currentPage = 0;
    let pageSize = 3;
    let totalAccounts = getTotalAccounts();
    let totalPages = 0;

    // -- GET запрос на получение списка игроков --
    getPlayers(currentPage, pageSize);
    function getPlayers(pageNumber, pageSize) {
        let xhr = new XMLHttpRequest();
        xhr.open('GET', '/rest/players?pageNumber=' + pageNumber + '&pageSize=' + pageSize, true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                let players = JSON.parse(xhr.responseText);
                fillTable(players);
                getTotalAccounts();
                updatePaginationButtons();
                updatePagination(players.length);
            }
        };
        xhr.send();
    }

    // -- GET запрос на получение общего количества игроков --
    function getTotalAccounts() {
        let xhr = new XMLHttpRequest();
        xhr.open('GET', '/rest/players/count', true);
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4 && xhr.status === 200) {
                totalAccounts = parseInt(xhr.responseText);
                calculateTotalPages();
            }
        };
        xhr.send();
    }

    // -- GET запрос на удаление игрока с указанным id --
    function deleteAccount(playerId) {
        let xhr = new XMLHttpRequest();
        xhr.open('DELETE', '/rest/players/' + playerId, true);
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    console.log('Аккаунт с id=' + playerId + ' успешно удален.');
                    // После успешного удаления аккаунта, обновляем список аккаунтов
                    getPlayers(currentPage, pageSize);
                } else {
                    console.error('Ошибка при удалении аккаунта с id=' + playerId + '.');
                }
            }
        };
        xhr.send();
    }
    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
    // -- Функция для обработки редактирования аккаунта --
    function editAccount(playerId, updatedPlayerData) {
        let xhr = new XMLHttpRequest();
        xhr.open('PUT', '/rest/players/' + playerId, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function() {
            if (xhr.readyState === 4) {
                if (xhr.status === 200) {
                    console.log('Аккаунт с id=' + playerId + ' успешно обновлен.');
                    getPlayers(currentPage, pageSize);
                } else {
                    console.error('Ошибка при обновлении аккаунта с id=' + playerId + '.');
                }
            }
        };
        xhr.send(JSON.stringify(updatedPlayerData));
    }

    //+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

    function getDropdownOptions() {
        // Верните здесь массив или объект с возможными значениями для Race и Profession
        return {
            raceOptions: ["HUMAN","DWARF","ELF","GIANT","ORC","TROLL","HOBBIT"], // Пример значений для Race
            professionOptions: [ "WARRIOR","ROGUE","SORCERER","CLERIC","PALADIN","NAZGUL","WARLOCK","DRUID"], // Пример значений для Profession
            banned: ["true", "false"]
        };
    }

    function createDropdownSelect(options, selectedValue) {
        let select = document.createElement('select');
        options.forEach(function(option) {
            let optionElement = document.createElement('option');
            optionElement.textContent = option;
            if (option === selectedValue) {
                optionElement.selected = true;
            }
            select.appendChild(optionElement);
        });
        return select;
    }

    // -- Заполнение таблицы списком игроков --

    function fillTable(players) {
        // Заполнение tbody данными
        tbody.innerHTML = '';  // -- Очистка tbody перед заполнением --
        let dropdownOptions = getDropdownOptions();
        // -- Заполнение tbody данными --
        for (let key in players) {
            let player = players[key];
            let row = tbody.insertRow();
            let idCell = row.insertCell();
            idCell.textContent = player.id;
            let nameCell = row.insertCell();
            nameCell.textContent = player.name;
            let titleCell = row.insertCell();
            titleCell.textContent = player.title;
            let raceCell = row.insertCell();
            raceCell.textContent = player.race;
            let professionCell = row.insertCell();
            professionCell.textContent = player.profession;
            let levelCell = row.insertCell();
            levelCell.textContent = player.level;
            let birthdayCell = row.insertCell();
            let birthdayDate = new Date(player.birthday);
            let formattedDate = birthdayDate.toISOString().split('T')[0];
            birthdayCell.textContent = formattedDate;
            let bannedCell = row.insertCell();
            bannedCell.textContent = player.banned;

            //////////////////////////////////
            // -- Добавление колонки "Edit" с иконкой редактирования --
            let editCell = row.insertCell();
            let editIconUrl = '/img/edit.png';
            let editIcon = document.createElement('img');
            editIcon.src = editIconUrl;
            editIcon.alt = 'Edit';
            editIcon.addEventListener('click', function() {
                if (editIcon.alt === 'Edit') {
                    // При клике на кнопку "Edit" делаем поля редактируемыми
                    nameCell.innerHTML = '<input type="text" value="' + player.name + '">';
                    titleCell.innerHTML = '<input type="text" value="' + player.title + '">';
                    let raceSelect = createDropdownSelect(dropdownOptions.raceOptions, player.race.toString());
                    raceCell.innerHTML = '';
                    raceCell.appendChild(raceSelect);
                    let professionSelect = createDropdownSelect(dropdownOptions.professionOptions, player.profession.toString());
                    professionCell.innerHTML = '';
                    professionCell.appendChild(professionSelect);
                    let bannedSelect = createDropdownSelect(dropdownOptions.banned, player.banned.toString());
                    bannedCell.innerHTML = '';
                    bannedCell.appendChild(bannedSelect);

                    editIcon.alt = 'Save';
                    editIcon.src = '/img/save.png';
                    deleteIcon.style.display = 'none';
                } else if (editIcon.alt === 'Save') {
                    // При клике на кнопку "Save" сохраняем изменения и вызываем функцию редактирования
                    let updatedPlayerData = {
                        name: nameCell.querySelector('input').value,
                        title: titleCell.querySelector('input').value,
                        race: raceCell.querySelector('select').value,
                        profession: professionCell.querySelector('select').value,
                        banned: bannedCell.querySelector('select').value === 'true'
                    };
                    editAccount(player.id, updatedPlayerData);
                    editIcon.alt = 'Edit';
                    editIcon.src = '/img/edit.png';
                    deleteIcon.style.display = 'inline';

                    // Возвращаем обычные текстовые данные после сохранения
                    nameCell.textContent = updatedPlayerData.name;
                    titleCell.textContent = updatedPlayerData.title;
                    raceCell.textContent = updatedPlayerData.race;
                    professionCell.textContent = updatedPlayerData.profession;
                    bannedCell.textContent = updatedPlayerData.banned.toString();
                }
            });
            editCell.appendChild(editIcon);

            // -- Добавление колонки "Delete" с иконкой удаления --
            let deleteCell = row.insertCell();
            let deleteIconUrl = '/img/delete.png'; // Путь к изображению иконки удаления
            let deleteIcon = document.createElement('img');
            deleteIcon.id = 'delete-button-' + player.id;
            deleteIcon.className = 'delete-button';
            deleteIcon.src = deleteIconUrl;
            deleteIcon.alt = 'Delete';
            deleteIcon.addEventListener('click', function() {
                // Вызываем функцию удаления аккаунта с заданным id
                deleteAccount(player.id);
            });
            deleteCell.appendChild(deleteIcon);
            ///////////////////////////////////
        }
    }

    // -- Вычисление общего количества страниц --
    function calculateTotalPages() {
        totalPages = Math.ceil(totalAccounts / pageSize);
    }

    // -- Обновление спика кнопок с нумерациями страниц --
    function updatePaginationButtons() {
        paginationSection.innerHTML = '';
        for (let i = 0; i < totalPages; i++) {
            let button = document.createElement('button');
            button.textContent = i+1;
            button.value = i;
            button.id = "myButton";
            button.addEventListener('click', function() {
                currentPage = parseInt(this.value);
                getPlayers(currentPage, pageSize);
                updatePaginationButtons();
            });
            paginationSection.appendChild(button);
        }
    }

    function updatePagination(accountCount) {
        if (accountCount === 0) {
            paginationSection.innerHTML = '';
            return;
        }
        let paginationButtons = paginationSection.querySelectorAll('button');
        paginationButtons.forEach(function(button) {
            button.disabled = parseInt(button.value) === currentPage;
        });
    }

    function changePageSize() {
        pageSize = parseInt(selectElement.value);
        getPlayers(0, pageSize);
        getTotalAccounts();
    }
    document.getElementById('pageSize').addEventListener('change', changePageSize);

</script>
>>>>>>> b79a02e (Add_Tomcat_server)



</body>
</html>